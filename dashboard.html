<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ê–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å –∑–∞–∫–∞–∑–æ–≤</title>
<style>
  body { font-family: sans-serif; background:#f6f7fb; padding:24px; }
  .top { text-align:center; margin-bottom: 12px; }
  input, button { padding:10px; font-size:16px; margin:4px; }
  table { width:100%; border-collapse: collapse; background:#fff; }
  th, td { border:1px solid #ddd; padding:8px; text-align:center; }
  th { background:#f0f0f0; }
</style>
</head>
<body>

<script>
  const REQUIRED_PASSWORD = "klondike2025";
  const entered = prompt("üîí –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:");
  if (entered !== REQUIRED_PASSWORD) {
    alert("‚õî –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
    location.href = "https://google.com";
  }
</script>

<h2>–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h2>
<div class="top">
  <input id="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û/ID/–ü–í–ó" onkeyup="filter()">
  <button onclick="exportCSV()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
  <button onclick="load()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
</div>
<table id="tbl">
  <thead>
    <tr>
      <th>ID</th><th>–ö–ª–∏–µ–Ω—Ç</th><th>–ö–æ–¥</th><th>–ü–í–ó</th><th>–°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è</th><th>–°–æ–∑–¥–∞–Ω</th><th>–°—Ç–∞—Ç—É—Å</th><th>–û–ø–ª–∞—Ç–∞</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<script>
const API="http://localhost:5000";
function load(){
  fetch(API+"/orders").then(r=>r.json()).then(rows=>{
    const tb=document.querySelector("#tbl tbody"); tb.innerHTML="";
    rows.forEach(o=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${o.id}</td><td>${o.client_name}</td><td>${o.pickup_code}</td><td>${o.pvz}</td><td>${o.expires||''}</td><td>${o.created_at}</td><td>${o.status}</td><td>${o.paid?'‚úÖ':'‚ùå'}</td>`;
      tb.appendChild(tr);
    });
  });
}
function filter(){
  const q=document.getElementById("q").value.toLowerCase();
  document.querySelectorAll("#tbl tbody tr").forEach(tr=>{ tr.style.display = tr.innerText.toLowerCase().includes(q) ? "" : "none"; });
}
function exportCSV(){
  let csv="ID;–ö–ª–∏–µ–Ω—Ç;–ö–æ–¥;–ü–í–ó;–°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è;–°–æ–∑–¥–∞–Ω;–°—Ç–∞—Ç—É—Å;–û–ø–ª–∞—Ç–∞\n";
  document.querySelectorAll("#tbl tbody tr").forEach(tr=>{
    const cols=[...tr.querySelectorAll("td")].map(td=>td.innerText.replace(/;/g,","));
    csv+=cols.join(";")+"\n";
  });
  const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="orders.csv"; document.body.appendChild(a); a.click(); a.remove();
}
window.onload=load;
</script>
</body>
</html>
