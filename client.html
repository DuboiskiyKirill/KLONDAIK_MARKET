<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
<style>
  body { font-family: sans-serif; background:#f6f7fb; padding:24px; text-align: center; }
  .card { background:#fff; max-width:700px; margin:auto; padding:24px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
  input, button { padding: 12px; margin: 6px; font-size: 16px; }
  img { max-width: 220px; display:block; margin: 10px auto; }
</style>
</head>
<body>
<div class="card">
  <h2>–ú–æ–π –∑–∞–∫–∞–∑</h2>
  <input id="order_id" placeholder="ID –∑–∞–∫–∞–∑–∞">
  <button onclick="load()">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å</button>
  <div id="info"></div>
</div>
<script>
const API="http://localhost:5000";
function load(){
  const id=document.getElementById("order_id").value;
  fetch(API+"/order/"+id).then(r=>r.json()).then(o=>{
    if(!o||o.success===false){ document.getElementById("info").innerText="–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω"; return; }
    const qr=encodeURIComponent(JSON.stringify({id:o.id,client_name:o.client_name,pickup_code:o.pickup_code}));
    const url=`https://api.qrserver.com/v1/create-qr-code/?data=${qr}&size=220x220`;
    document.getElementById("info").innerHTML=`
      <p><b>–ö–ª–∏–µ–Ω—Ç:</b> ${o.client_name}</p>
      <p><b>–ü–í–ó:</b> ${o.pvz}</p>
      <p><b>–ö–æ–¥:</b> ${o.pickup_code}</p>
      <p><b>–°—Ç–∞—Ç—É—Å:</b> ${o.status} | <b>–û–ø–ª–∞—á–µ–Ω:</b> ${o.paid?'–î–∞':'–ù–µ—Ç'}</p>
      <img src="${url}" alt="QR">
      ${o.paid?'':`<button onclick="pay(${o.id})">üí≥ –û–ø–ª–∞—Ç–∏—Ç—å (–∑–∞–≥–ª—É—à–∫–∞)</button>`}
    `;
  }).catch(()=>{ document.getElementById("info").innerText="–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"; });
}
function pay(id){
  fetch(API+"/payment_callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:id})})
    .then(r=>r.json()).then(d=>{ if(d.success){ alert("–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞"); load(); }});
}
</script>
</body>
</html>
