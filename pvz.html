<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ü–í–ó ‚Äî –ü—Ä–∏—ë–º</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body { font-family: sans-serif; background:#f6f7fb; padding:24px; }
  .card { background:#fff; max-width:700px; margin:auto; padding:24px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
  #reader { width: 320px; margin: 12px auto; }
  .status { text-align:center; font-size: 18px; }
</style>
</head>
<body>

<script>
  const REQUIRED_PASSWORD = "klondike2025";
  const entered = prompt("üîí –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:");
  if (entered !== REQUIRED_PASSWORD) {
    alert("‚õî –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
    location.href = "https://google.com";
  }
</script>

<div class="card">
  <h2>–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR —Å –ø–æ—Å—ã–ª–∫–∏ (–ø—Ä–∏—ë–º)</h2>
  <div id="reader"></div>
  <p class="status" id="status"></p>
</div>
<script>
const API = "http://localhost:5000";
function onScanSuccess(text) {
  try {
    const obj = JSON.parse(text);
    if (!obj.id) throw new Error("No id");
    fetch(API + "/accept/" + obj.id, { method: "POST" })
      .then(r => r.json()).then(d => {
        document.getElementById("status").innerText = d.success ? ("‚úÖ –ü—Ä–∏–Ω—è—Ç –∑–∞–∫–∞–∑ #" + d.order_id) : "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏—ë–º–µ";
      });
  } catch(e) {
    document.getElementById("status").innerText = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π QR";
  }
  scanner.clear();
}
const scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
scanner.render(onScanSuccess);
</script>
</body>
</html>
